!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.rbush=t()}}(function(){return function t(i,n,e){function r(h,o){if(!n[h]){if(!i[h]){var s="function"==typeof require&&require;if(!o&&s)return s(h,!0);if(a)return a(h,!0);var l=new Error("Cannot find module '"+h+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[h]={exports:{}};i[h][0].call(c.exports,function(t){var n=i[h][1][t];return r(n?n:t)},c,c.exports,t,i,n,e)}return n[h].exports}for(var a="function"==typeof require&&require,h=0;h<e.length;h++)r(e[h]);return r}({1:[function(t,i,n){"use strict";function e(t,i){return this instanceof e?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this._nodesUuid={},i&&this._initFormat(i),void this.clear()):new e(t,i)}function r(t,i,n){if(!n)return i.indexOf(t);for(var e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}function a(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function h(t,i){return t.minX-i.minX}function o(t,i){return t.minY-i.minY}function s(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function c(t,i){return(Math.max(i.maxX,t.maxX)-Math.min(i.minX,t.minX))*(Math.max(i.maxY,t.maxY)-Math.min(i.minY,t.minY))}function u(t,i){var n=Math.max(t.minX,i.minX),e=Math.max(t.minY,i.minY),r=Math.min(t.maxX,i.maxX),a=Math.min(t.maxY,i.maxY);return Math.max(0,r-n)*Math.max(0,a-e)}function f(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function d(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function m(t,i,n,e,r){for(var a,h=[i,n];h.length;)n=h.pop(),i=h.pop(),n-i<=e||(a=i+Math.ceil((n-i)/e/2)*e,x(t,a,i,n,r),h.push(i,a,a,n))}i.exports=e;var x=t("quickselect"),p=t("./lib/uuid.js");e.prototype={all:function(t){return t=t||this.data,this._all(t,[])},getNode:function(t){return this._nodesUuid[t]},walk:function(t){var i=[],n=this.data,e=function(n){if(i.push(n),t(n,i),!n.children)return void i.pop(n);for(var r=0;r<n.children.length;r++)e(n.children[r]);i.pop(n)};e(n)},search:function(t){var i=this.data,n={parentNodes:{},leafNodes:[]},e=this.toBBox;if(!d(t,i))return n;for(var r,a,h,o,s=[];i;){for(r=0,a=i.children.length;r<a;r++)h=i.children[r],o=i.leaf?e(h):h,d(t,o)&&(n.parentNodes[i.height]=n.parentNodes[i.height]||{},n.parentNodes[i.height][i.id]=i,i.leaf?n.leafNodes.push(h):f(t,o)?this._all(h,n.leafNodes,n.parentNodes):s.push(h));i=s.pop()}return n},collides:function(t){var i=this.data,n=this.toBBox;if(!d(t,i))return!1;for(var e,r,a,h,o=[];i;){for(e=0,r=i.children.length;e<r;e++)if(a=i.children[e],h=i.leaf?n(a):a,d(t,h)){if(i.leaf||f(t,h))return!0;o.push(a)}i=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;i<n;i++)this.insert(t[i]);return this}var e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){var r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=this._createNode([]),this},remove:function(t,i){if(!t)return this;for(var n,e,a,h,o=this.data,s=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),e=l[l.length-1],n=c.pop(),h=!0),o.leaf&&(a=r(t,o.children,i),a!==-1))return o.children.splice(a,1),l.push(o),this._condense(l),this;h||o.leaf||!f(o,s)?e?(n++,o=e.children[n],h=!1):o=null:(l.push(o),c.push(n),n=0,e=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:h,compareMinY:o,toJSON:function(){return this.data},fromJSON:function(t){var i=this;return this.data=t,this.walk(function(t){i._nodesUuid[t.id]=t}),this},_all:function(t,i,n){n=n||{};for(var e=[];t;)n[t.height]=n[t.height]||{},n[t.height][t.id]=t,t.leaf?i.push.apply(i,t.children):e.push.apply(e,t.children),t=e.pop();return i},_build:function(t,i,n,e){var r,a=n-i+1,h=this._maxEntries;if(a<=h)return r=this._createNode(t.slice(i,n+1)),this._calcBBox(r,this.toBBox),r;e||(e=Math.ceil(Math.log(a)/Math.log(h)),h=Math.ceil(a/Math.pow(h,e-1))),r=this._createNode([]),r.leaf=!1,r.height=e;var o,s,l,c,u=Math.ceil(a/h),f=u*Math.ceil(Math.sqrt(h));for(m(t,i,n,f,this.compareMinX),o=i;o<=n;o+=f)for(l=Math.min(o+f-1,n),m(t,o,l,u,this.compareMinY),s=o;s<=l;s+=u)c=Math.min(s+u-1,l),r.children.push(this._build(t,s,c,e-1));return this._calcBBox(r,this.toBBox),r},_chooseSubtree:function(t,i,n,e){for(var r,a,h,o,l,u,f,d;;){if(e.push(i),i.leaf||e.length-1===n)break;for(f=d=1/0,r=0,a=i.children.length;r<a;r++)h=i.children[r],l=s(h),u=c(t,h)-l,u<d?(d=u,f=l<f?l:f,o=h):u===d&&l<f&&(f=l,o=h);i=o||i.children[0]}return i},_insert:function(t,i,n){var e=this.toBBox,r=n?t:e(t),h=[],o=this._chooseSubtree(r,this.data,i,h);for(o.children.push(t),a(o,r);i>=0&&h[i].children.length>this._maxEntries;)this._split(h,i),i--;this._adjustParentBBoxes(r,h,i)},_split:function(t,i){var n=t[i],e=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,e);var a=this._chooseSplitIndex(n,r,e),h=this._createNode(n.children.splice(a,n.children.length-a));h.height=n.height,h.leaf=n.leaf,this._calcBBox(n,this.toBBox),this._calcBBox(h,this.toBBox),i?t[i-1].children.push(h):this._splitRoot(n,h)},_splitRoot:function(t,i){this.data=this._createNode([t,i]),this.data.height=t.height+1,this.data.leaf=!1,this._calcBBox(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,n){var e,r,a,h,o,l,c,f;for(l=c=1/0,e=i;e<=n-i;e++)r=this._distBBox(t,0,e,this.toBBox),a=this._distBBox(t,e,n,this.toBBox),h=u(r,a),o=s(r)+s(a),h<l?(l=h,f=e,c=o<c?o:c):h===l&&o<c&&(c=o,f=e);return f},_chooseSplitAxis:function(t,i,n){var e=t.leaf?this.compareMinX:h,r=t.leaf?this.compareMinY:o,a=this._allDistMargin(t,i,n,e),s=this._allDistMargin(t,i,n,r);a<s&&t.children.sort(e)},_allDistMargin:function(t,i,n,e){t.children.sort(e);var r,h,o=this.toBBox,s=this._distBBox(t,0,i,o),c=this._distBBox(t,n-i,n,o),u=l(s)+l(c);for(r=i;r<n-i;r++)h=t.children[r],a(s,t.leaf?o(h):h),u+=l(s);for(r=n-i-1;r>=i;r--)h=t.children[r],a(c,t.leaf?o(h):h),u+=l(c);return u},_adjustParentBBoxes:function(t,i,n){for(var e=n;e>=0;e--)a(i[e],t)},_condense:function(t){for(var i,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(i=t[n-1].children,i.splice(i.indexOf(t[n]),1)):this.clear():this._calcBBox(t[n],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")},_calcBBox:function(t,i){this._distBBox(t,0,t.children.length,i,t)},_distBBox:function(t,i,n,e,r){r||(r=this._createNode(null)),r.minX=1/0,r.minY=1/0,r.maxX=-(1/0),r.maxY=-(1/0);for(var h,o=i;o<n;o++)h=t.children[o],a(r,t.leaf?e(h):h);return r},_createNode:function(t){var i=p(),n={children:t,height:1,id:i,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)};return this._nodesUuid[i]=n,n}}},{"./lib/uuid.js":2,quickselect:3}],2:[function(t,i,n){var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",r=8;i.exports=function(){for(var t="",i=0;i<r;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}},{}],3:[function(t,i,n){"use strict";function e(t,i,n,h,o){for(n=n||0,h=h||t.length-1,o=o||a;h>n;){if(h-n>600){var s=h-n+1,l=i-n+1,c=Math.log(s),u=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1),d=Math.max(n,Math.floor(i-l*u/s+f)),m=Math.min(h,Math.floor(i+(s-l)*u/s+f));e(t,i,d,m,o)}var x=t[i],p=n,_=h;for(r(t,n,i),o(t[h],x)>0&&r(t,n,h);p<_;){for(r(t,p,_),p++,_--;o(t[p],x)<0;)p++;for(;o(t[_],x)>0;)_--}0===o(t[n],x)?r(t,n,_):(_++,r(t,_,h)),_<=i&&(n=_+1),i<=_&&(h=_-1)}}function r(t,i,n){var e=t[i];t[i]=t[n],t[n]=e}function a(t,i){return t<i?-1:t>i?1:0}i.exports=e},{}]},{},[1])(1)});
